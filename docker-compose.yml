services:
  # Development container for running checks before commits
  # Usage:
  #   docker-compose run --rm dev bash
  #   Inside container:
  #     cargo fmt --check          # Check formatting
  #     cargo fmt                  # Auto-fix formatting
  #     cargo clippy --all-targets --all-features -- -D warnings  # Run linter
  #     cargo test --all           # Run tests
  #     cargo build                # Build project
  dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      # Mount project directory
      - .:/app
      # Cache cargo registry and git dependencies for faster builds
      - cargo-cache:/usr/local/cargo/registry
      - cargo-git:/usr/local/cargo/git
      # Cache build artifacts
      - target-cache:/app/target
    working_dir: /app
    environment:
      - CARGO_HOME=/usr/local/cargo
    command: /bin/bash
    stdin_open: true
    tty: true

volumes:
  cargo-cache:
  cargo-git:
  target-cache:

